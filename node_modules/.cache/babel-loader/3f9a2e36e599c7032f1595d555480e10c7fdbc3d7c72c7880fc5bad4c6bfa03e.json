{"ast":null,"code":"import axios from \"axios\";\nimport * as LANGUAGE from '../../store/language.json';\nimport SnackBar from \"../Snackbar/SnackBar.vue\";\nexport default {\n  name: \"UserManagementTable\",\n  data() {\n    return {\n      role_items: [{\n        text: 'Admin',\n        value: 1\n      }, {\n        text: 'Agent',\n        value: 0\n      }],\n      role: 0,\n      showPassword: false,\n      showConfirmPassword: false,\n      snackbar: {\n        show: false,\n        message: null,\n        color: null\n      },\n      sex: \"frau\",\n      isCreateMode: true,\n      search: \"\",\n      activePicker: null,\n      date: null,\n      menu: false,\n      dialog: false,\n      dialogDelete: false,\n      headers: [{\n        text: \"#\",\n        value: \"id\"\n      }, {\n        text: this.translate(\"First name\"),\n        value: \"first_name\"\n      }, {\n        text: this.translate(\"Last name\"),\n        value: \"last_name\"\n      }, {\n        text: this.translate(\"Phone\"),\n        value: \"phone\"\n      }, {\n        text: this.translate(\"Actions\"),\n        value: \"actions\"\n      }],\n      data: [],\n      loading: true,\n      options: {},\n      totalTableData: 0,\n      create_data: {\n        customer_id: \"\",\n        insurance_id: \"\",\n        sent_on: \"\",\n        status_id: \"\",\n        category_id: \"\"\n      },\n      create_new_agent: {\n        email: \"\",\n        first_name: \"\",\n        last_name: \"\",\n        password: \"\",\n        password_confirmation: \"\",\n        approved: 1,\n        phone: \"\"\n      },\n      new_agent_data: {},\n      get_item_data: [],\n      contract_statuses: [],\n      contract_categories: [],\n      clients_list: [],\n      insurance_list: [],\n      deleteItemId: 0,\n      updateItemId: 0,\n      default_item_data: {\n        customer_id: \"\",\n        insurance_id: \"\",\n        sent_on: \"\",\n        status_id: \"\",\n        category_id: \"\"\n      }\n    };\n  },\n  computed: {\n    formTitle() {\n      return this.isCreateMode === true ? \"Create User\" : \"Edit User\";\n    },\n    user_role_id() {\n      const user = JSON.parse(localStorage.getItem('user'));\n      return user.role_id;\n    }\n  },\n  watch: {\n    dialog(val) {\n      val || this.close();\n    },\n    dialogDelete(val) {\n      val || this.closeDelete();\n    },\n    options: {\n      handler() {\n        this.getItemsTable();\n      },\n      deep: true\n    },\n    menu(val) {\n      val && setTimeout(() => this.activePicker = \"YEAR\");\n    }\n  },\n  methods: {\n    translate(word) {\n      let wordIndex = null;\n      LANGUAGE.forEach((lng, index) => {\n        if (lng.english.toLowerCase() == word.toLowerCase()) {\n          wordIndex = index;\n        }\n      });\n      if (wordIndex === null) {\n        return word;\n      }\n      if (this.$store.state.language == \"german\") {\n        return LANGUAGE[wordIndex].german;\n      } else {\n        return LANGUAGE[wordIndex].english;\n      }\n    },\n    getItemsTable() {\n      this.loading = true;\n      const {\n        sortBy,\n        sortDesc,\n        page,\n        itemsPerPage\n      } = this.options;\n      let sortType;\n      sortType = \"asc\";\n      if (sortDesc[0]) {\n        sortType = \"desc\";\n      }\n      axios.get(\"/admin/userdatatable\", {\n        params: {\n          sort_by: sortBy[0],\n          sort: sortType,\n          page: page,\n          per_page: itemsPerPage\n        }\n      }).then(response => {\n        this.data = response.data.data;\n        this.totalTableData = response.data.total;\n        this.loading = false;\n        this.$nextTick(() => {\n          const currentEl = this.$el.querySelector(\".v-data-footer__pagination\");\n          const translated = currentEl.innerHTML.replace(\"of\", this.translate(\"of\"));\n          currentEl.innerHTML = translated;\n        });\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    createItem() {\n      axios.post(\"/register\", {\n        email: this.create_new_agent.email,\n        first_name: this.create_new_agent.first_name,\n        last_name: this.create_new_agent.last_name,\n        password: this.create_new_agent.password,\n        password_confirmation: this.create_new_agent.password_confirmation,\n        approved: 1,\n        phone: this.create_new_agent.phone,\n        role_id: this.role\n      }).then(response => {\n        this.snackbar = {\n          message: \"New agent created successfully\",\n          color: \"success\",\n          show: true,\n          error: false\n        };\n        this.$refs.snackbar.toggleSnackbar();\n        this.approveUser(response.data.user_id);\n      }).catch(error => {\n        console.log(\"test\", error);\n        this.snackbar = {\n          message: error.response.data.message,\n          color: \"error\",\n          error: true\n        };\n        this.$refs.snackbar.toggleSnackbar();\n      });\n    },\n    approveUser(userId) {\n      axios.put(\"/approve_agent\", {\n        user_id: userId\n      }).then(() => {\n        this.getItemsTable();\n      }).catch(err => console.log(err));\n    },\n    getItem(itemId) {\n      this.create_new_agent = {};\n      axios.get(\"admin/user/\" + itemId).then(response => {\n        const {\n          email,\n          first_name,\n          last_name,\n          phone,\n          role_id\n        } = response.data.data;\n        this.create_new_agent = {\n          email,\n          first_name,\n          last_name,\n          password: \"\",\n          password_confirmation: \"\",\n          phone\n        };\n        this.role = parseInt(role_id);\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    updateItem(itemId) {\n      axios.put(\"admin/user/\" + itemId, {\n        first_name: this.create_new_agent.first_name,\n        last_name: this.create_new_agent.last_name,\n        phone: this.create_new_agent.phone,\n        email: this.create_new_agent.email,\n        role_id: this.role\n      }).then(response => {\n        this.snackbar = {\n          message: response.data.message,\n          color: \"success\",\n          error: false\n        };\n        this.$refs.snackbar.toggleSnackbar();\n        this.getItemsTable();\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    deleteItem(itemId) {\n      axios.delete(\"/admin/user/\" + itemId).then(response => {\n        this.snackbar = {\n          message: response.data.message,\n          color: \"success\",\n          error: false\n        };\n        this.$refs.snackbar.toggleSnackbar();\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    openDialog() {\n      this.create_data = this.default_item_data;\n      this.isCreateMode = true;\n      this.dialog = true;\n    },\n    editItem(item) {\n      this.isCreateMode = false;\n      this.getItem(item.id);\n      this.updateItemId = item.id;\n      this.dialog = true;\n    },\n    deleteItemModal(item) {\n      this.deleteItemId = item.id;\n      this.dialogDelete = true;\n    },\n    deleteItemModalConfirm() {\n      this.closeDelete();\n      this.deleteItem(this.deleteItemId);\n      this.getItemsTable();\n    },\n    close() {\n      this.dialog = false;\n    },\n    closeDelete() {\n      this.dialogDelete = false;\n    },\n    save() {\n      this.close();\n      this.createItem();\n    },\n    update() {\n      this.close();\n      this.updateItem(this.updateItemId);\n    },\n    saveDate(date) {\n      this.$refs.menu.save(date);\n    }\n  },\n  mounted() {\n    this.getItemsTable();\n  },\n  components: {\n    SnackBar\n  }\n};","map":{"version":3,"names":["axios","LANGUAGE","SnackBar","name","data","role_items","text","value","role","showPassword","showConfirmPassword","snackbar","show","message","color","sex","isCreateMode","search","activePicker","date","menu","dialog","dialogDelete","headers","translate","loading","options","totalTableData","create_data","customer_id","insurance_id","sent_on","status_id","category_id","create_new_agent","email","first_name","last_name","password","password_confirmation","approved","phone","new_agent_data","get_item_data","contract_statuses","contract_categories","clients_list","insurance_list","deleteItemId","updateItemId","default_item_data","computed","formTitle","user_role_id","user","JSON","parse","localStorage","getItem","role_id","watch","val","close","closeDelete","handler","getItemsTable","deep","setTimeout","methods","word","wordIndex","forEach","lng","index","english","toLowerCase","$store","state","language","german","sortBy","sortDesc","page","itemsPerPage","sortType","get","params","sort_by","sort","per_page","then","response","total","$nextTick","currentEl","$el","querySelector","translated","innerHTML","replace","catch","error","console","log","createItem","post","$refs","toggleSnackbar","approveUser","user_id","userId","put","err","itemId","parseInt","updateItem","deleteItem","delete","openDialog","editItem","item","id","deleteItemModal","deleteItemModalConfirm","save","update","saveDate","mounted","components"],"sources":["src/components/UserManagement/UserManagementTable.vue"],"sourcesContent":["<template>\r\n  <v-row>\r\n    <SnackBar :data=\"snackbar\" ref=\"snackbar\"></SnackBar>\r\n\r\n    <v-col cols=\"12\" xs=\"12\" sm=\"12\" md=\"4\" lg=\"4\">\r\n      <v-text-field\r\n        prepend-inner-icon=\"mdi-magnify\"\r\n        filled\r\n        rounded\r\n        :background-color=\"!$vuetify.theme.dark && '#fff'\"\r\n        :label=\"translate('Search')\"\r\n        v-model=\"search\"\r\n      >\r\n      </v-text-field>\r\n    </v-col>\r\n\r\n    <v-col cols=\"12\" md=\"12\" lg=\"12\">\r\n      <div class=\"d-flex justify-end\">\r\n        <v-btn color=\"primary\" dark class=\"mb-2\" @click=\"openDialog\">\r\n          <v-icon>mdi-plus</v-icon> {{ translate('Create User') }}\r\n        </v-btn>\r\n      </div>\r\n      <v-data-table\r\n        :headers=\"headers\"\r\n        :items=\"data\"\r\n        :loading=\"loading\"\r\n        :options.sync=\"options\"\r\n        :server-items-length=\"totalTableData\"\r\n        :search=\"search\"\r\n        :footer-props=\"{'items-per-page-text':translate('Rows per page'), 'items-per-page-all-text':translate('All')}\"\r\n      >\r\n        <template v-slot:loading>\r\n          {{translate('Loading items')}}...\r\n        </template>\r\n        <template v-slot:no-data>\r\n          {{translate('No data available')}}\r\n        </template>\r\n        <template v-slot:top>\r\n          <v-toolbar flat>\r\n            <v-spacer></v-spacer>\r\n            <v-dialog v-model=\"dialog\" max-width=\"500px\">\r\n              <v-card>\r\n                <v-card-title>\r\n                  <span class=\"text-h5\">{{ translate(formTitle) }}</span>\r\n                </v-card-title>\r\n\r\n                <v-card-text>\r\n                  <v-container>\r\n                    <v-row>\r\n                      <!-- <v-col cols=\"12\" sm=\"12\" md=\"12\">\r\n                        <v-radio-group v-model=\"sex\" row>\r\n                          <v-radio label=\"Frau\" value=\"frau\"></v-radio>\r\n                          <v-radio label=\"Herr\" value=\"herr\"></v-radio>\r\n                        </v-radio-group>\r\n                      </v-col> -->\r\n                      <v-col cols=\"12\">\r\n                        <v-select v-model=\"role\" :items=\"role_items\" :label=\"translate('Role')\"></v-select>\r\n                      </v-col>\r\n                      <v-col cols=\"12\" sm=\"6\" md=\"6\">\r\n                        <v-text-field\r\n                          v-model=\"create_new_agent.first_name\"\r\n                          :label=\"translate('First Name')\"\r\n                        ></v-text-field>\r\n                      </v-col>\r\n                      <v-col cols=\"12\" sm=\"6\" md=\"6\">\r\n                        <v-text-field\r\n                          v-model=\"create_new_agent.last_name\"\r\n                          :label=\"translate('Last Name')\"\r\n                        ></v-text-field>\r\n                      </v-col>\r\n\r\n                      <v-col cols=\"12\" sm=\"6\" md=\"6\">\r\n                        <v-text-field\r\n                          v-model=\"create_new_agent.email\"\r\n                          :label=\"translate('Email')\"\r\n                        ></v-text-field>\r\n                      </v-col>\r\n\r\n                      <v-col cols=\"12\" sm=\"6\" md=\"6\">\r\n                        <v-text-field\r\n                          v-model=\"create_new_agent.phone\"\r\n                          type=\"number\"\r\n                          :label=\"translate('Phone Nr.')\"\r\n                        ></v-text-field>\r\n                      </v-col>\r\n\r\n                      <v-col cols=\"12\" sm=\"12\" md=\"12\" v-if=\"isCreateMode\">\r\n                        <v-text-field\r\n                          v-model=\"create_new_agent.password\"\r\n                          :label=\"translate('Password')\"\r\n                          :type=\"showPassword ? 'text' : 'password'\"\r\n                          @click:append=\"showPassword = !showPassword\"\r\n                          required\r\n                          :append-icon=\"showPassword ? 'mdi-eye-outline' : 'mdi-eye-off-outline'\"\r\n                          prepend-inner-icon=\"mdi-lock-outline\"\r\n                        ></v-text-field>\r\n                      </v-col>\r\n\r\n                      <v-col cols=\"12\" sm=\"12\" md=\"12\" v-if=\"isCreateMode\">\r\n                        <v-text-field\r\n                          v-model=\"create_new_agent.password_confirmation\"\r\n                          :label=\"translate('Repeat Password')\"\r\n                          :type=\"showConfirmPassword ? 'text' : 'password'\"\r\n                          @click:append=\"showConfirmPassword = !showConfirmPassword\"\r\n                          required\r\n                          :append-icon=\"showConfirmPassword ? 'mdi-eye-outline' : 'mdi-eye-off-outline'\"\r\n                          prepend-inner-icon=\"mdi-lock-outline\"\r\n                        ></v-text-field>\r\n                      </v-col>\r\n\r\n\r\n                      <!-- <v-col cols=\"12\" sm=\"6\" md=\"6\">\r\n                        <v-menu\r\n                          ref=\"menu\"\r\n                          v-model=\"menu\"\r\n                          :close-on-content-click=\"false\"\r\n                          transition=\"scale-transition\"\r\n                          offset-y\r\n                          min-width=\"auto\"\r\n                        >\r\n                          <template v-slot:activator=\"{ on, attrs }\">\r\n                            <v-text-field\r\n                              v-model=\"date\"\r\n                              :label=\"translate('Birthday')\"\r\n                              prepend-inner-icon=\"mdi-calendar-outline\"\r\n                              readonly\r\n                              v-bind=\"attrs\"\r\n                              v-on=\"on\"\r\n                            ></v-text-field>\r\n                          </template>\r\n                          <v-date-picker\r\n                            v-model=\"date\"\r\n                            :active-picker.sync=\"activePicker\"\r\n                            :max=\"\r\n                              new Date(\r\n                                Date.now() -\r\n                                  new Date().getTimezoneOffset() * 60000\r\n                              )\r\n                                .toISOString()\r\n                                .substr(0, 10)\r\n                            \"\r\n                            min=\"1950-01-01\"\r\n                          ></v-date-picker>\r\n                        </v-menu>\r\n                      </v-col> -->\r\n\r\n                      <!-- <v-col cols=\"12\" sm=\"6\" md=\"6\">\r\n                        <v-select\r\n                          v-model=\"create_data.insurance_id\"\r\n                          label=\"Role\"\r\n                        ></v-select>\r\n                      </v-col> -->\r\n                    </v-row>\r\n                  </v-container>\r\n                </v-card-text>\r\n\r\n                <v-card-actions>\r\n                  <v-spacer></v-spacer>\r\n                  <v-btn color=\"blue darken-1\" text @click=\"close\">\r\n                    {{translate('Cancel')}}\r\n                  </v-btn>\r\n\r\n                  <v-btn\r\n                    v-show=\"isCreateMode\"\r\n                    color=\"blue darken-1\"\r\n                    text\r\n                    @click=\"save\"\r\n                  >\r\n                    {{ translate('Create') }}\r\n                  </v-btn>\r\n                  <v-btn\r\n                    v-show=\"!isCreateMode && create_new_agent.email.length > 0\"\r\n                    color=\"blue darken-1\"\r\n                    text\r\n                    @click=\"update\"\r\n                  >\r\n                    {{translate('Update')}}\r\n                  </v-btn>\r\n                </v-card-actions>\r\n              </v-card>\r\n            </v-dialog>\r\n            <v-dialog v-model=\"dialogDelete\" max-width=\"500px\">\r\n              <v-card>\r\n                <v-card-title class=\"text-h5\"\r\n                  >{{translate('Are you sure you want to delete this item?')}}</v-card-title\r\n                >\r\n                <v-card-actions>\r\n                  <v-spacer></v-spacer>\r\n                  <v-btn color=\"blue darken-1\" text @click=\"closeDelete\" :class=\"{ 'btn-dark': $vuetify.theme.dark }\"\r\n                    >{{ translate('Cancel') }}</v-btn\r\n                  >\r\n                  <v-btn\r\n                    color=\"blue darken-1\"\r\n                    text\r\n                    @click=\"deleteItemModalConfirm()\"\r\n                    >OK</v-btn\r\n                  >\r\n                  <v-spacer></v-spacer>\r\n                </v-card-actions>\r\n              </v-card>\r\n            </v-dialog>\r\n          </v-toolbar>\r\n        </template>\r\n\r\n        <template v-slot:[`item.actions`]=\"{ item }\">\r\n          <div class=\"d-flex\" v-if=\"user_role_id != item.role_id\">\r\n            <v-btn icon @click=\"editItem(item)\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M15.6219 6.68218C15.7485 6.65503 15.8563 6.57958 15.9257 6.4698C15.9945 6.36117 16.0168 6.22724 15.9872 6.10208C15.7856 5.25056 15.4499 4.44053 14.9892 3.69502C14.9218 3.58581 14.8112 3.50692 14.6859 3.47861C14.5591 3.45002 14.4295 3.47272 14.3208 3.54313C13.7915 3.8847 13.0835 3.80883 12.6375 3.36265C12.1913 2.91662 12.1155 2.20878 12.457 1.67939C12.5274 1.57061 12.5501 1.441 12.5215 1.31426C12.4932 1.18896 12.4143 1.07831 12.3053 1.01091C11.5595 0.550241 10.7496 0.21442 9.8978 0.0129422C9.77293 -0.0166593 9.63886 0.00575736 9.53022 0.0744449C9.42044 0.143849 9.345 0.251622 9.31785 0.378218C9.18579 0.994534 8.63156 1.44171 8.00002 1.44171C7.36847 1.44171 6.81425 0.994533 6.68219 0.378071C6.65503 0.251475 6.57959 0.143702 6.46981 0.0742978C6.36117 0.0054672 6.22725 -0.0168067 6.10223 0.0127951C5.25041 0.214402 4.44053 0.550057 3.69502 1.01077C3.58581 1.07816 3.50692 1.1888 3.47861 1.31411C3.45002 1.44085 3.47272 1.57047 3.54313 1.67924C3.8847 2.20848 3.80883 2.91647 3.36265 3.3625C2.91662 3.80868 2.20878 3.88454 1.67939 3.54298C1.57061 3.47257 1.441 3.44987 1.31426 3.47847C1.18896 3.50677 1.07831 3.58566 1.01091 3.69473C0.550242 4.44049 0.214421 5.25038 0.0129427 6.1022C-0.0166588 6.22707 0.00575759 6.36114 0.0744451 6.46977C0.14385 6.57956 0.251622 6.655 0.378218 6.68215C0.994534 6.81421 1.44171 7.36844 1.44171 7.99998C1.44171 8.63153 0.994534 9.18575 0.378071 9.31781C0.251475 9.34497 0.143703 9.42041 0.074298 9.53019C0.00546743 9.63882 -0.0168068 9.77275 0.012795 9.89791C0.214402 10.7494 0.550058 11.5595 1.01077 12.305C1.07816 12.4142 1.18881 12.4931 1.31411 12.5214C1.44085 12.55 1.57047 12.5273 1.67924 12.4569C2.20848 12.1153 2.91647 12.1912 3.3625 12.6373C3.80868 13.0834 3.88454 13.7912 3.54298 14.3206C3.47272 14.4294 3.44987 14.559 3.47847 14.6857C3.50677 14.811 3.58566 14.9217 3.69473 14.9891C4.44049 15.4498 5.25038 15.7856 6.1022 15.9871C6.13827 15.9957 6.17505 15.9997 6.21184 15.9997C6.30237 15.9997 6.39247 15.9744 6.46977 15.9254C6.57956 15.856 6.655 15.7482 6.68216 15.6216C6.81421 15.0055 7.36844 14.5583 7.99998 14.5583C8.63153 14.5583 9.18575 15.0055 9.31781 15.6219C9.34497 15.7485 9.42041 15.8563 9.53019 15.9257C9.63883 15.9945 9.77275 16.0168 9.89777 15.9872C10.7496 15.7856 11.5595 15.4499 12.3052 14.9892C12.4143 14.9218 12.4932 14.8112 12.5215 14.6859C12.5501 14.5592 12.5271 14.4295 12.457 14.3208C12.1154 13.7915 12.1913 13.0835 12.6375 12.6375C13.0835 12.1913 13.7913 12.1155 14.3207 12.457C14.4295 12.5273 14.5591 12.5501 14.6859 12.5215C14.8112 12.4932 14.9218 12.4143 14.9892 12.3053C15.4499 11.5595 15.7857 10.7496 15.9872 9.89806V9.89791C16.0168 9.77304 15.9944 9.63897 15.9257 9.53034C15.8563 9.42056 15.7485 9.34511 15.6219 9.31796C15.0054 9.18576 14.5583 8.63153 14.5583 7.99998C14.5583 7.36844 15.0054 6.81422 15.6219 6.68216L15.6219 6.68218ZM4.99734 8.00001C4.99734 6.34176 6.34162 4.99749 7.99987 4.99749C9.65812 4.99749 11.0024 6.34176 11.0024 8.00001C11.0024 9.65826 9.65812 11.0025 7.99987 11.0025C6.34162 11.0025 4.99734 9.65826 4.99734 8.00001Z\" fill=\"#36A5DD\"/>\r\n              </svg>\r\n            </v-btn>\r\n            <v-btn icon @click=\"deleteItemModal(item)\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M13.6564 2.34278C12.1561 0.842612 10.1212 0 7.99967 0C5.87804 0 3.84335 0.842939 2.34294 2.34327C0.842775 3.84359 0 5.87833 0 8C0 10.1217 0.842775 12.1563 2.34294 13.6567C3.84327 15.1571 5.878 16 7.99967 16C10.1213 16 12.1564 15.1573 13.6564 13.6572C14.6543 12.6669 15.3728 11.4302 15.7384 10.0727C16.1041 8.7151 16.1041 7.28494 15.7384 5.92743C15.3728 4.56996 14.6543 3.33318 13.6564 2.34294V2.34278ZM10.6736 9.86278L10.6735 9.86294C10.7781 9.97215 10.8364 10.1174 10.8364 10.2685C10.8364 10.4199 10.7781 10.5651 10.6735 10.6743C10.5606 10.7764 10.4142 10.8333 10.2621 10.8344C10.1134 10.8331 9.97051 10.776 9.86209 10.6743L7.9992 8.81142L6.1363 10.6743C6.02788 10.776 5.88502 10.8331 5.73627 10.8344C5.58416 10.8333 5.4378 10.7764 5.32492 10.6743C5.22033 10.5651 5.16197 10.4199 5.16197 10.2685C5.16197 10.1174 5.22033 9.97215 5.32492 9.86294L7.18782 8.00004L5.32492 6.13714C5.10091 5.91313 5.10091 5.54975 5.32492 5.32575C5.54893 5.10175 5.91231 5.10174 6.13631 5.32575L7.9992 7.18865L9.8621 5.32575C10.0861 5.10174 10.4495 5.10174 10.6735 5.32575C10.8975 5.54976 10.8975 5.91314 10.6735 6.13714L8.81059 8.00004L10.6736 9.86278Z\" fill=\"#D20000\"/>\r\n              </svg>\r\n            </v-btn>\r\n          </div>\r\n        </template>\r\n      </v-data-table>\r\n    </v-col>\r\n  </v-row>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport * as LANGUAGE from '../../store/language.json';\r\nimport SnackBar from \"../Snackbar/SnackBar.vue\";\r\n\r\nexport default {\r\n    name: \"UserManagementTable\",\r\n    data() {\r\n        return {\r\n            role_items: [\r\n              { text: 'Admin', value: 1 },\r\n              { text: 'Agent', value: 0 },\r\n            ],\r\n            role: 0,\r\n            showPassword: false,\r\n            showConfirmPassword: false,\r\n            snackbar: {\r\n                show: false,\r\n                message: null,\r\n                color: null,\r\n            },\r\n            sex: \"frau\",\r\n            isCreateMode: true,\r\n            search: \"\",\r\n            activePicker: null,\r\n            date: null,\r\n            menu: false,\r\n            dialog: false,\r\n            dialogDelete: false,\r\n            headers: [\r\n                { text: \"#\", value: \"id\" },\r\n                { text: this.translate(\"First name\"), value: \"first_name\" },\r\n                { text: this.translate(\"Last name\"), value: \"last_name\" },\r\n                { text: this.translate(\"Phone\"), value: \"phone\" },\r\n                { text: this.translate(\"Actions\"), value: \"actions\" },\r\n            ],\r\n            data: [],\r\n            loading: true,\r\n            options: {},\r\n            totalTableData: 0,\r\n            create_data: {\r\n                customer_id: \"\",\r\n                insurance_id: \"\",\r\n                sent_on: \"\",\r\n                status_id: \"\",\r\n                category_id: \"\",\r\n            },\r\n            create_new_agent: {\r\n                email: \"\",\r\n                first_name: \"\",\r\n                last_name: \"\",\r\n                password: \"\",\r\n                password_confirmation: \"\",\r\n                approved: 1,\r\n                phone: \"\"\r\n            },\r\n            new_agent_data: {},\r\n            get_item_data: [],\r\n            contract_statuses: [],\r\n            contract_categories: [],\r\n            clients_list: [],\r\n            insurance_list: [],\r\n            deleteItemId: 0,\r\n            updateItemId: 0,\r\n            default_item_data: {\r\n                customer_id: \"\",\r\n                insurance_id: \"\",\r\n                sent_on: \"\",\r\n                status_id: \"\",\r\n                category_id: \"\",\r\n            },\r\n        };\r\n    },\r\n    computed: {\r\n        formTitle() {\r\n            return this.isCreateMode === true ? \"Create User\" : \"Edit User\";\r\n        },\r\n        user_role_id() {\r\n          const user = JSON.parse(localStorage.getItem('user'));\r\n\r\n          return user.role_id;\r\n        }\r\n    },\r\n    watch: {\r\n        dialog(val) {\r\n            val || this.close();\r\n        },\r\n        dialogDelete(val) {\r\n            val || this.closeDelete();\r\n        },\r\n        options: {\r\n            handler() {\r\n                this.getItemsTable();\r\n            },\r\n            deep: true,\r\n        },\r\n        menu(val) {\r\n            val && setTimeout(() => (this.activePicker = \"YEAR\"));\r\n        },\r\n    },\r\n    methods: {\r\n        translate(word) {\r\n            let wordIndex = null;\r\n            LANGUAGE.forEach((lng, index) => {\r\n                if (lng.english.toLowerCase() == word.toLowerCase()) {\r\n                    wordIndex = index;\r\n                }\r\n            });\r\n            if (wordIndex === null) {\r\n                return word;\r\n            }\r\n            if (this.$store.state.language == \"german\") {\r\n                return LANGUAGE[wordIndex].german;\r\n            }\r\n            else {\r\n                return LANGUAGE[wordIndex].english;\r\n            }\r\n        },\r\n        getItemsTable() {\r\n            this.loading = true;\r\n            const { sortBy, sortDesc, page, itemsPerPage } = this.options;\r\n            let sortType;\r\n            sortType = \"asc\";\r\n            if (sortDesc[0]) {\r\n                sortType = \"desc\";\r\n            }\r\n            axios\r\n                .get(\"/admin/userdatatable\", {\r\n                params: {\r\n                    sort_by: sortBy[0],\r\n                    sort: sortType,\r\n                    page: page,\r\n                    per_page: itemsPerPage,\r\n                },\r\n            })\r\n                .then((response) => {\r\n                this.data = response.data.data;\r\n                this.totalTableData = response.data.total;\r\n                this.loading = false;\r\n\r\n                this.$nextTick(() => {\r\n                  const currentEl = this.$el.querySelector(\".v-data-footer__pagination\");\r\n                  const translated = currentEl.innerHTML.replace(\"of\", this.translate(\"of\"));\r\n\r\n                  currentEl.innerHTML = translated;\r\n                });\r\n            })\r\n                .catch((error) => {\r\n                console.log(error);\r\n            });\r\n        },\r\n        createItem() {\r\n            axios\r\n                .post(\"/register\", {\r\n                email: this.create_new_agent.email,\r\n                first_name: this.create_new_agent.first_name,\r\n                last_name: this.create_new_agent.last_name,\r\n                password: this.create_new_agent.password,\r\n                password_confirmation: this.create_new_agent.password_confirmation,\r\n                approved: 1,\r\n                phone: this.create_new_agent.phone,\r\n                role_id: this.role\r\n            })\r\n                .then((response) => {\r\n                this.snackbar = {\r\n                    message: \"New agent created successfully\",\r\n                    color: \"success\",\r\n                    show: true,\r\n                    error: false\r\n                };\r\n\r\n                this.$refs.snackbar.toggleSnackbar();\r\n\r\n                this.approveUser(response.data.user_id);\r\n            })\r\n              .catch((error) => {\r\n                console.log(\"test\", error);\r\n                this.snackbar = {\r\n                    message: error.response.data.message,\r\n                    color: \"error\",\r\n                    error: true,\r\n                };\r\n\r\n                this.$refs.snackbar.toggleSnackbar();\r\n            });\r\n        },\r\n        approveUser(userId) {\r\n            axios\r\n                .put(\"/approve_agent\", {\r\n                user_id: userId\r\n            })\r\n                .then(() => {\r\n                this.getItemsTable();\r\n            })\r\n                .catch(err => console.log(err));\r\n        },\r\n        getItem(itemId) {\r\n            this.create_new_agent = {};\r\n            axios\r\n                .get(\"admin/user/\" + itemId)\r\n                .then((response) => {\r\n                const { email, first_name, last_name, phone, role_id } = response.data.data;\r\n                this.create_new_agent = {\r\n                    email,\r\n                    first_name,\r\n                    last_name,\r\n                    password: \"\",\r\n                    password_confirmation: \"\",\r\n                    phone\r\n                };\r\n\r\n                this.role = parseInt(role_id);\r\n            })\r\n                .catch((error) => {\r\n                console.log(error);\r\n            });\r\n        },\r\n        updateItem(itemId) {\r\n            axios\r\n                .put(\"admin/user/\" + itemId, {\r\n                first_name: this.create_new_agent.first_name,\r\n                last_name: this.create_new_agent.last_name,\r\n                phone: this.create_new_agent.phone,\r\n                email: this.create_new_agent.email,\r\n                role_id: this.role\r\n            })\r\n                .then((response) => {\r\n                this.snackbar = {\r\n                    message: response.data.message,\r\n                    color: \"success\",\r\n                    error: false,\r\n                };\r\n                this.$refs.snackbar.toggleSnackbar();\r\n                this.getItemsTable();\r\n            })\r\n                .catch((error) => {\r\n                console.log(error);\r\n            });\r\n        },\r\n        deleteItem(itemId) {\r\n            axios\r\n                .delete(\"/admin/user/\" + itemId)\r\n                .then((response) => {\r\n                this.snackbar = {\r\n                    message: response.data.message,\r\n                    color: \"success\",\r\n                    error: false,\r\n                };\r\n                this.$refs.snackbar.toggleSnackbar();\r\n            })\r\n                .catch((error) => {\r\n                console.log(error);\r\n            });\r\n        },\r\n        openDialog() {\r\n            this.create_data = this.default_item_data;\r\n            this.isCreateMode = true;\r\n            this.dialog = true;\r\n        },\r\n        editItem(item) {\r\n            this.isCreateMode = false;\r\n            this.getItem(item.id);\r\n            this.updateItemId = item.id;\r\n            this.dialog = true;\r\n        },\r\n        deleteItemModal(item) {\r\n            this.deleteItemId = item.id;\r\n            this.dialogDelete = true;\r\n        },\r\n        deleteItemModalConfirm() {\r\n            this.closeDelete();\r\n            this.deleteItem(this.deleteItemId);\r\n            this.getItemsTable();\r\n        },\r\n        close() {\r\n            this.dialog = false;\r\n        },\r\n        closeDelete() {\r\n            this.dialogDelete = false;\r\n        },\r\n        save() {\r\n            this.close();\r\n            this.createItem();\r\n        },\r\n        update() {\r\n            this.close();\r\n            this.updateItem(this.updateItemId);\r\n        },\r\n        saveDate(date) {\r\n            this.$refs.menu.save(date);\r\n        },\r\n    },\r\n    mounted() {\r\n        this.getItemsTable();\r\n    },\r\n    components: { SnackBar }\r\n};\r\n</script>\r\n\r\n<style>\r\n.v-data-table {\r\n  border-radius: 10px;\r\n}\r\n\r\n.v-data-table tr td {\r\n  border: none !important;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}